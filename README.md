# Open Library Crawlers

Scheduled web crawlers that write small URL metadata into a **separate `data` branch**.

## How data is stored

- Latest run output is written to `data/latest/urls.jsonl` on the `data` branch.
- Before each new run, the previous `data/latest/urls.jsonl` is archived to:
  - `data/archive/YYYY/MM/DD/urls.jsonl`

This matches the policy: **daily flush** (overwrite `latest`) + **archive the previous day**.

## Running locally

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r crawlers/requirements.txt

python main.py --crawler example --settings config/settings.yaml --out ./local-data

# Run all allowlisted crawlers
python main.py --settings config/settings.yaml --out ./local-data
```

## GitHub Actions

Workflow: [.github/workflows/crawl.yml](.github/workflows/crawl.yml)

- Runs daily at 02:00 UTC
- Can be manually triggered and scoped to a single crawler via `workflow_dispatch`

## Viewer (GitHub Pages)

A static viewer UI is available under [docs/](docs/) and is designed to be deployed with GitHub Pages.

- It fetches `data/latest/urls.jsonl` directly from the `data` branch (no backend).
- It supports filtering by `source` (crawler) and by website domain, plus search, sorting, and pagination.
- It can browse archives via `data/archive/index.json` (generated by the crawl workflow).

Deployment workflow: [.github/workflows/pages.yml](.github/workflows/pages.yml)

Usage notes:

- When hosted on GitHub Pages, the viewer auto-detects `owner/repo`.
- You can override the repo from the UI (top right) or via `?repo=owner/repo`.

## Adding a new crawler

1. Create `crawlers/<name>.py` exporting a `Crawler` class with a `.crawl(ctx)` method.
2. Add `<name>` to the list in `main.py` (intentional allowlist).
3. Add config under `crawlers.<name>` in [config/settings.yaml](config/settings.yaml).

## Proof-of-concept crawler

The `link_extract` crawler fetches a single page and extracts anchor URLs from it.
Configure it via `crawlers.link_extract` in [config/settings.yaml](config/settings.yaml).

## TODO
- Singapore Code and standard.
- Readible UI module (rendering the JSONL?)
- Original set:

| Website | Status |
|---|---|
| https://www.info.gov.hk/gia/ | partial |
| https://www.directory.gov.hk/ | partial |
| https://www.devb.gov.hk/ | partial |
| https://www.archsd.gov.hk/ | partial |
| https://www.cedd.gov.hk/ | todo |
| https://www.dsd.gov.hk/ | todo |
| https://www.emsd.gov.hk/ | todo |
| https://www.epd.gov.hk/ | todo |
| https://www.hyd.gov.hk/ | todo |
| https://www.wsd.gov.hk/ | todo |
| https://www.legco.gov.hk/ | todo |
